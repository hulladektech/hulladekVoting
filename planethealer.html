<!DOCTYPE html>
<html>
<head>
    <title>Hulladek Voting System</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="images/logo.png" type="image/x-icon"> 
    <link rel="stylesheet" type="text/css" href="assets/main.css">
</head>
<body>
<header><img src="images/logo.png" width="100px"></header>
<div class="row">
    <div class="col-md-6 col-md-offset-3">
        <form id="msform" method="POST">
            <fieldset>
                <h2 class="fs-title">PLANET HEALER OF THE MONTH</h2>
                <h3 class="fs-subtitle">Welcome to Online Voting System</h3>

                <h2 class="label-title">Award Type</h2>
                <select name="Award Type" required>
                    <option value="Planet Healer">Planet Healer</option>
                </select>

                <h2 class="label-title">Employee Name</h2>
                <select name="Employee Name" required>
                    <option value="">Please select the name from dropdown</option> 
                    <option value="Debopam Majumder">Debopam Majumder</option>
                    <option value="Ayushmaan Soni">Ayushmaan Soni</option>
                    <option value="Harpreet Singh Mann">Harpreet Singh Maan</option>
                    <option value="Barnali Dutta">Barnali Dutta</option>
                </select>

                <h2 class="label-title">Select Month</h2>
                <select name="Select Month" required>
                    <option value="">Select the Month</option>
                    <option value="Apr">Apr</option>
                    <option value="May">May</option>
                    <option value="Jun">Jun</option>
                    <option value="Jul">Jul</option>
                    <option value="Aug">Aug</option>
                    <option value="Sep">Sep</option>
                    <option value="Oct">Oct</option>
                    <option value="Nov">Nov</option>
                    <option value="Dec">Dec</option>
                    <option value="Jan">Jan</option>
                    <option value="Feb">Feb</option>
                    <option value="Mar">Mar</option>
                </select>

                <input type="submit" id="submit-button" class="submit action-button" value="Submit"/>
            </fieldset>
        </form>
        <div id="message" style="display: none;"></div>
    </div>
</div>

<script>
document.getElementById("msform").addEventListener("submit", async function (e) {
    e.preventDefault();

    const messageDiv = document.getElementById("message");
    const submitBtn = document.getElementById("submit-button");
    messageDiv.textContent = "Submitting...";
    messageDiv.style.display = "block";
    submitBtn.disabled = true;

    try {
        // Get IP address
        const ipRes = await fetch("https://api.ipify.org?format=json");
        const ipData = await ipRes.json();
        const ip = ipData.ip;

        // Prepare form data
        const form = document.getElementById("msform");
        const formData = new FormData(form);
        formData.append("GET_IP", ip);

        const bodyData = new URLSearchParams();
        for (let [key, value] of formData.entries()) {
            bodyData.append(key, value);
        }

        // Submit to Google Apps Script
        const response = await fetch("https://script.google.com/macros/s/AKfycbz6Gngjzsir9uv-v36YL0P71tJNceiBEoW-3RllMZg9XnbE7I9lZhVMRT69mAZhCs3a/exec", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
            body: bodyData.toString(),
        });

        const resultText = await response.text();
        let result;
        try {
            result = JSON.parse(resultText);
        } catch {
            throw new Error("Invalid server response");
        }

        if (result.status === "success") {
            window.location.href = "thankyou.html";
        } else {
            messageDiv.textContent = "❌ " + result.message;
        }
    } catch (err) {
        console.error(err);
        messageDiv.textContent = "❌ An error occurred while submitting the form.";
    } finally {
        messageDiv.style.display = "block";
        submitBtn.disabled = false;
        setTimeout(() => {
            messageDiv.style.display = "none";
        }, 3000);
    }
});
</script>

<!-- Optional: CSS for label-title -->
<style>
.label-title {
    font-size: 14px;
    text-align: left;
    padding: 18px 0px 8px;
    line-height: 21px;
}
</style>

<script type="text/javascript" src="assets/main.js"></script>
</body>
</html>
